<!-- ... existing code ... -->
<div class="mb-3">
    <label class="form-label">当前头像</label><br/>
    <!-- 确保正确使用 userAvatarUrl 显示当前头像 -->
    <img th:src="'uploads/avatars/' + ${session.currentUser.avatar_url}" alt="头像" class="rounded-circle" id="current-avatar">
</div>

<!-- 上传新头像 -->
<div class="mb-3">
    <label class="form-label">上传新头像</label>
    <input type="file" name="avatar" class="form-control" id="avatar-input" onchange="previewAvatar(this)">
    <!-- 添加预览区域 -->
    <div id="avatar-preview" style="margin-top: 10px;"></div>
</div>
<!-- ... existing code ... -->

<!-- 添加 JavaScript 代码用于预览和刷新页面 -->
<script>
    function previewAvatar(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $('#avatar-preview').html('<img src="' + e.target.result + '" alt="Preview" class="rounded-circle" style="max-width: 100px;">');
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 表单提交成功后刷新页面
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        form.addEventListener('submit', function() {
            // 提交成功后刷新页面（假设服务器端返回成功状态）
            setTimeout(function() {
                location.reload();
            }, 1000); // 延迟1秒刷新，确保服务器响应完成
        });
    });
</script>
<!-- ... existing code ... -->